<html>
    <head>
        <title>Association Rules</title>
        <style>
            /* * {
                outline: 1px red solid;
            } */
            .flex-container {
              width: 100%;
              height: 100%;
              display: flex;
            }
            .flex-item {
              display: inline-block;
              white-space: nowrap;
              overflow-y: scroll;
              width: 50%;
              height: 100%;
              margin: 5px;
            }
            .title-block {
              text-align: center;
              margin: 30px 40px 25px 40px;
              padding: 25px;
            }
            .block {
              margin: 25px 40px;
            }
            .text {
              margin: 10px;
            }
            .abstract {
              margin: 0 20px;
            }
            .flex-search {
              width: 100%;
              display: flex;
            }
            .flex-item-info {
              display: inline-block;
              width: 30px;
              margin: auto;
              margin-left: 5px;
              font-weight: bold;
            }
            .flex-item-value {
              display: inline-block;
              width: 90%;
              margin: 5px;
            }
            .right-button {
              margin-right: 5px;
              float: right;
            }
            .submit-button {
              background-color: rgb(251, 139, 12);
              border: none;
              color: white;
              padding: 3px 15px;
              text-align: center;
              text-decoration: none;
              display: inline-block;
              border-radius: 10px;
              font-weight: bold;
            }
            .search, .show {
              margin-left: 30px;
            }
        </style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        {% load static %}
        <link rel="stylesheet" href="{% static '/css/navbar.css' %}">

    </head>
    <body>
      {% include 'navbar.html' %}
      <div id="container">
        <div class="title-block">
          <h2>Supersite 與天氣因子的關聯規則</h2>
          <a href="/static/publication/使用關聯規則挖掘埔里天氣因子與PM2.5規則_論文全文.pdf">研討會論文</a>
        </div>
        <div class="block">
          <h3>實驗方法</h3>
          <div class="text">
            <h6>資料</h6>
            <ul>
              <li>實驗期間：2006~2020 年</li>
              <li>PM2.5：<a href="https://airtw.epa.gov.tw/CHT/EnvMonitoring/Local/LocalMonitoring.aspx">行政院環保署</a></li>
              <li>氣象資料(氣壓、溫度、濕度、風速、風向、雨量)：中央氣象局觀測資料查詢系統(CODiS)</li>
            </ul>
            <h6>摘要</h6>
            <div class="abstract">將埔里 PM2.5 與六個天氣因子(氣壓、溫度、濕度、風速、風向、雨量)進行關聯規則分析，找出隱藏的關聯規則。先將所有資料進行離散化，使用離散化的 PM2.5、氣壓、溫度、濕度、風速、風向資料依照設計挖掘出關聯規則，後將規則與各級雨量進行統計分析，評估雨量對於規則發生之影響。</div>
          </div>
        </div>
        <div class="block">
          <h3>使用說明</h3>
          <div class="text">
            <ol>
              <li>year：(必須)選擇想要了解的年份，2006~2020 年擇一</li>
              <li>site：(必須)選擇測站（目前僅提供南投埔里）</li>
              <li>Support >=：(必須)以最小支持度篩選規則，0.0~1.0範圍內的浮點數</li>
              <li>Confidence >=：(必須)以最小信賴度篩選規則，0.0~1.0範圍內的浮點數</li>
              <li>Antecedents ⊂ & Consequents ⊂：(非必須)篩選前後項出現的元素，可填入以下幾個標籤進行搜尋</li>
                <ul>
                  <li>PM2.5四個層級：PM2.5_1、PM2.5_2、PM2.5_3、PM2.5_H</li>
                  <li>溫度三個層級：temperature_L、temperature_M、temperature_H</li>
                  <li>濕度三個層級：RH_L、RH_M、RH_H</li>
                  <li>風速三個層級：WS_L、WS_M、WS_H</li>
                  <li>風向八方位：WD_N、WD_NW、WD_W、WD_SW、WD_S、WD_SE、WD_E、WD_NE</li>
                  <li>雨量三個等級：precip_L、precip_M、precip_H</li>
                </ul>
            </ol>
          </div>
        </div>
        <div class = "flex-container">
          <div id = "super_mapid" class="flex-item"></div>
          <div class="flex-item">
            <div class="search">
              <h3>選擇篩選的因子與門檻</h3>
              <div class="search-box">
                <div class="flex-search">
                  <div class="flex-item-info">
                    必填
                  </div>
                  <div class="flex-item-value">
                    year = 
                    <select id = "super_year">
                      <option>2006</option>
                      <option>2007</option>
                      <option>2008</option>
                      <option>2009</option>
                      <option>2010</option>
                      <option>2011</option>
                      <option>2012</option>
                      <option>2013</option>
                      <option>2014</option>
                      <option>2015</option>
                      <option>2016</option>
                      <option>2017</option>
                      <option>2018</option>
                      <option>2019</option>
                      <option>2020</option>
                    </select>
                    site = 
                    <select id = "super_site">
                      <option>南投-埔里</option>
                    </select>
                    <br/>
                    Support >= <input id="super_minSupport" size="6" value="0.05">
                    Confidence >= <input id="super_minConfidence" size="6" value="0.8">
                  </div>
                </div>
                <div class="flex-search">
                  <div class="flex-item-info">
                    選填
                  </div>
                  <div class="flex-item-value">
                    Antecedents ⊂ <input id="super_antecedents" size="40"><br/>
                    Consequents ⊂ <input id="super_consequents" size="40">
                  </div>
                </div>
                <div class="right-button">
                  <button id="super_trigger" class="submit-button">Submit</button>
                </div>
                <br/>
              </div>
            </div>
            <div class="show">
              <h3>找到的規則</h3><span id="super_countid"></span>
              <div id="super_rulesid" class="rules"></div>
            </div>
          </div>
        </div>

        <div class="title-block">
          <h2>Microsite 與人文、地理因子的關聯規則</h2>
        </div>
        <div class="block">
          <h3>實驗方法</h3>
          <div class="text">
            <h6>資料</h6>
            <ul>
              <li>實驗期間：2017~2020 年</li>
              <li>PM2.5：<a href="http://www.airq.org.tw/">國立暨南國際大學</a></li>
              <li>自然環境資料(等高線)：<a href="https://maps.nlsc.gov.tw/S09SOA/">內政部國土測繪中心</a></li>
              <li>人文活動資料(土地用途)：<a href="https://luz.tcd.gov.tw/WEB/default.aspx">內政部營建署</a></li>
              <li>人文活動資料(污染產業)：<a href="https://prtr.epa.gov.tw/">內政部環保署</a></li>
              <li>人文活動資料(廟宇)：<a href="https://www.google.com.tw/maps/search/%E5%9F%94%E9%87%8C+%E5%BB%9F%E5%AE%87/@23.9675683,120.9459359,14z">Google</a></li>
              <li>人文活動資料(廟宇)：<a href="https://www.google.com.tw/maps/search/%E5%9F%94%E9%87%8C+%E5%8A%A0%E6%B2%B9%E7%AB%99/@23.9676407,120.9459359,14z/data=!3m1!4b1">Google</a></li>
            </ul>
            <h6>摘要</h6>
            <div class="abstract">單一的 Supersite 與大環境差異不大的天氣因子進行關聯規則分析，而在埔里有多個 Microsite，能夠與小範圍的人文因子及自然地貌進行關聯規則分析，找出隱藏的規則。先設定個別因子影響的距離，若是距離內有該因子，則標注是，反之則標註否，進行關聯規則後，視覺化結果，從中找出不同於其他測站的規則。</div>
          </div>
        </div>
        <div class="block">
          <h3>使用說明</h3>
          <div class="text">
            <ol>
              <li>year：(必須)選擇想要了解的年份，2017~2020 年擇一</li>
              <li>site：(必須)選擇測站（目前僅提供南投埔里架設的微感測器）</li>
              <li>Support >=：(必須)以最小支持度篩選規則，0.0~1.0範圍內的浮點數</li>
              <li>Confidence >=：(必須)以最小信賴度篩選規則，0.0~1.0範圍內的浮點數</li>
              <li>Antecedents ⊂ & Consequents ⊂：(非必須)篩選前後項出現的元素，可填入以下幾個標籤進行搜尋</li>
                <ul>
                  <li>PM2.5四個層級：PM2.5_1、PM2.5_2、PM2.5_3、PM2.5_H</li>
                  <li>十二個月：month_1,month_2,month_3,month_4,month_5,month_6,month_7,month_8,month_9,month_10,month_11,month_12</li>
                  <li>二十四小時：hour_0, hour_1, hour_2, hour_3, hour_4, hour_5, hour_6, hour_7,hour_8, hour_9, hour_10, hour_11, hour_12, hour_13, hour_14,hour_15, hour_16, hour_17, hour_18, hour_19, hour_20, hour_21,hour_22, hour_23</li>
                  <li>是否是小學：小學_F、小學_T</li>
                  <li>是否是住宅區：住宅區_F、住宅區_T</li>
                  <li>附近三百公尺內是否有燃料零售業：燃料零售業_F、燃料零售業_Ｔ</li>
                  <li>附近三百公尺內是否有紙漿、紙及紙板製造業：紙漿、紙及紙板製造業_F、紙漿、紙及紙板製造業_Ｔ</li>
                </ul>
            </ol>
          </div>
        </div>

        <div class = "flex-container">
          <div id = "micro_mapid" class="flex-item"></div>
          <div class="flex-item">
            <div class="search">
              <h3>選擇篩選的因子與門檻</h3>
              <div class="search-box">
                <div class="flex-search">
                  <div class="flex-item-info">
                    必填
                  </div>
                  <div class="flex-item-value">
                    year = 
                    <select id = "micro_year">
                      <option>2017</option>
                      <option>2018</option>
                      <option>2019</option>
                      <option>2020</option>
                    </select>
                    site = 
                    <select id = "micro_site">
                      <option>大成國小</option>
                      <option>山里好巷</option>
                      <option>中峰國小</option>
                      <option>太平國小</option>
                      <option>日管處埔里工作站</option>
                      <option>加賀屋</option>
                      <option>自救會-1</option>
                      <option>自救會-10</option>
                      <option>自救會-2</option>
                      <option>自救會-5</option>
                      <option>自救會-6</option>
                      <option>自救會-7</option>
                      <option>自救會-8</option>
                      <option>育英國小</option>
                      <option>忠孝國小</option>
                      <option>埔里鯉魚潭</option>
                      <option>阿里婆冰</option>
                      <option>南光國小</option>
                      <option>埔里國小</option>
                      <option>桃源國小</option>
                      <option>愛蘭國小</option>
                      <option>溪南國小</option>
                      <option>暨大附中-中廊</option>
                      <option>暨大附中-側門</option>
                      <option>暨南大學-1</option>
                      <option>蒙愛教會</option>
                      <option>麒麟國小</option>
                      <option>籃城書房</option>
                    </select>
                    <br/>
                    Support >= <input id="micro_minSupport" size="6" value="0.05">
                    Confidence >= <input id="micro_minConfidence" size="6" value="0.8">
                    <br/>
                  </div>
                </div>
                <div class="flex-search">
                  <div class="flex-item-info">
                    選填
                  </div>
                  <div class="flex-item-value">
                    Antecedents ⊂ <input id="micro_antecedents" size="40"><br/>
                    Consequents ⊂ <input id="micro_consequents" size="40">
                  </div>
                </div>
                <div class="right-button">
                  <button id="micro_trigger" class="submit-button">Submit</button>
                </div>
                <br/>
              </div>
            </div>
            <div class="show">
              <h3>找到的規則</h3><span id="micro_countid"></span>
              <div id="micro_rulesid" class="rules"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- 地圖 -->
      <link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
      <script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
      <!-- 地圖 marker -->
      <link rel="stylesheet" href="/static/Leaflet_extra_markers/css/leaflet.extra-markers.min.css">
      <script src="/static/Leaflet_extra_markers/js/leaflet.extra-markers.min.js"></script>
      <!-- 地圖 icon -->
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
      <!-- 經緯度資料 -->
      <!-- <script type="text/javascript" src="/static/data/location.json"></script> -->
      <script type="text/javascript" src="/static/js/location.json"></script>

      <!-- 規則資料 -->
      <script type="text/javascript" src="/static/data/micrositeRules.js"></script>
      <!-- <script type="text/javascript" src="/static/data/supersiteRules.js"></script> -->
      <script type="text/javascript" src="/static/js/supersiteRules.js"></script>
      <script type="text/javascript">
        // --- 地圖 ---//
        // 國土測繪中心提供之地圖資料
        var nlsc_EMAP98 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP98/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_EMAP97 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP97/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_PHOTO_MIX = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/PHOTO_MIX/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_B5000 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/B5000/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_MOI_SLOPEP_LV7_2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/MOI_SLOPEP_LV7_2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_MOI_CONTOUR_2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/MOI_CONTOUR_2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_LUIMAP = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP109/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}), // 使用 109 年
        nlsc_CITY = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/CITY/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_SCHOOL = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/SCHOOL/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_ROAD = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/ROAD/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_ConvenienceStore = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/ConvenienceStore/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        nlsc_EMAP2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        LUIMAP01 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP01/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 農業
        LUIMAP02 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP02/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 森林
        LUIMAP03 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP03/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 交通
        LUIMAP04 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP04/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 水利
        LUIMAP05 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP05/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 建築
        LUIMAP06 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP06/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 公共
        LUIMAP07 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP07/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 遊憩
        LUIMAP08 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP08/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 礦鹽
        LUIMAP09 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP09/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 其他

        // 顯示之地圖中心、大小、底圖
        var super_map = L.map('super_mapid', {
            center: [23.96782835, 120.9582682],
            zoom: 13,
            layers: nlsc_EMAP98,
        });

        // --- 感測器 --- //
        for (var i = 0; i < supersite_coordinate.length; i++) {
            marker = new L.marker(
              [supersite_coordinate[i][1], supersite_coordinate[i][2]], // 圓心座標
                {icon: L.ExtraMarkers.icon({
                  icon: 'fa-number',
                  markerColor: 'cyan',   // 圖標顏色
                  shape: 'circle',       // 圖標形狀
                  prefix: 'fa',
                  number: i+1, 
              })})
            .bindPopup(supersite_coordinate[i][0])
            .addTo(super_map);
        }

        // 圖層管理
        var super_baseMaps = {
            "臺灣通用電子地圖": nlsc_EMAP98,
            "Taiwan E-Map(EN)": nlsc_EMAP97,
            "臺灣通用電子地圖正射影像(航照混合) ": nlsc_PHOTO_MIX,
        };
        var super_overlayMaps = {
            "等高線圖": nlsc_MOI_CONTOUR_2,
            "縣市界": nlsc_CITY,
            "臺灣通用電子地圖道路路網": nlsc_ROAD,
            "臺灣通用電子地圖(透明)": nlsc_EMAP2,
            "國土利用現況調查成果圖": nlsc_LUIMAP,
        };
        L.control.layers(super_baseMaps, super_overlayMaps).addTo(super_map);

        var mnlsc_EMAP98 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP98/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_EMAP97 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP97/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_PHOTO_MIX = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/PHOTO_MIX/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_B5000 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/B5000/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_MOI_SLOPEP_LV7_2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/MOI_SLOPEP_LV7_2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_MOI_CONTOUR_2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/MOI_CONTOUR_2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_LUIMAP = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP109/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}), // 使用 109 年
        mnlsc_CITY = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/CITY/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_SCHOOL = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/SCHOOL/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_ROAD = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/ROAD/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_ConvenienceStore = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/ConvenienceStore/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mnlsc_EMAP2 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/EMAP2/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}),
        mLUIMAP01 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP01/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 農業
        mLUIMAP02 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP02/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 森林
        mLUIMAP03 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP03/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 交通
        mLUIMAP04 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP04/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 水利
        mLUIMAP05 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP05/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 建築
        mLUIMAP06 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP06/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 公共
        mLUIMAP07 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP07/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 遊憩
        mLUIMAP08 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP08/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 礦鹽
        mLUIMAP09 = L.tileLayer('https://wmts.nlsc.gov.tw/wmts/LUIMAP09/default/EPSG:3857/{z}/{y}/{x}', {attribution: '圖資來源：<a href="https://maps.nlsc.gov.tw/" target="_blank">國土測繪圖資服務雲</a>'}); // 其他

        // 顯示之地圖中心、大小、底圖
        var micro_map = L.map('micro_mapid', {
            center: [23.96782835, 120.9582682],
            zoom: 13,
            layers: mnlsc_EMAP98,
        });

        // --- 廟宇 --- // 
        var temple = L.layerGroup();
        for (var i = 0; i < temple_coordinate.length; i++) {
            marker = new L.marker(
              [temple_coordinate[i][1], temple_coordinate[i][2]],
                {icon: L.divIcon({
                html: "<i class='fa fa-university fa-2x' style='color: red'></i>",
                iconSize: [20, 20],
                className: 'myDivIcon'
              })})
            .bindPopup(temple_coordinate[i][0])
            .addTo(micro_map);
            temple.addLayer(marker);
        }

        // --- 汙染源 --- //
        var pollution = L.layerGroup();
        for (var i = 0; i < pollution_coordinate.length; i++) {
            marker = new L.marker(
              [pollution_coordinate[i][1], pollution_coordinate[i][2]],
                {icon: L.divIcon({
                html: "<i class='fa fa-exclamation-triangle fa-2x' style='color: #FB8117'/></i>",
                iconSize: [20, 20],
                className: 'myDivIcon'
              })})
            .bindPopup(pollution_coordinate[i][0])
            .addTo(micro_map);
            pollution.addLayer(marker);
        }

        // -- 加油站 -- //
        var gasStation= L.layerGroup();
        for (var i = 0; i < gasStation_coordinate.length; i++) {
            marker = new L.marker(
              [gasStation_coordinate[i][1], gasStation_coordinate[i][2]],
                {icon: L.divIcon({
                html: "<i class='fas fa-gas-pump fa-2x' style='color: green'></i>",
                iconSize: [20, 20],
                className: 'myDivIcon'
              })})
            .bindPopup(gasStation_coordinate[i][0])
            .addTo(micro_map);
            gasStation.addLayer(marker);
        }
        // --- 路口 --- //
        var intersection = L.layerGroup();
        for (var i = 0; i < intersection_polygon.length; i++) {
            polygon = new L.polygon(intersection_polygon[i], {color: 'green'}).bindPopup(intersectionP_nameList[i]).addTo(micro_map);
            intersection.addLayer(polygon);
        }
        for (var i = 0; i < intersection_circle.length; i++) {
            circle = new L.circle(intersection_circle[i], 30, {color: 'green'}).bindPopup(intersectionC_nameList[i]).addTo(micro_map);
            intersection.addLayer(circle);
        }
        // --- 夜市 --- //
        var nightMarket = L.layerGroup();
        for (var i = 0; i < nightMarket_polygon.length; i++) {
            polygon = new L.polygon(nightMarket_polygon[i], {color: 'red'}).bindPopup(nightMarket_nameList[i]).addTo(micro_map);
            nightMarket.addLayer(polygon);
        }
        // --- 微感測器 --- //
        // 加入圖標、並圈出周圍300公尺的圓形區域
        for (var i = 0; i < microsite_coordinate.length; i++) {
            if (microsite_coordinate[i][0] == "自救會-3"){
                continue;
            }
            marker = new L.marker(
              [microsite_coordinate[i][1], microsite_coordinate[i][2]], // 圓心座標
                {icon: L.ExtraMarkers.icon({
                  icon: 'fa-number',
                  markerColor: 'cyan',   // 圖標顏色
                  shape: 'circle',       // 圖標形狀
                  prefix: 'fa',
                  number: i+1, 
              })})
            .bindPopup(microsite_coordinate[i][0])
            .addTo(micro_map);
            circle = new L.circle(
              [microsite_coordinate[i][1], microsite_coordinate[i][2]], // 圓心座標
              300,                     // 半徑（公尺）
              {
                color: '#183059',      // 線條顏色
                fillColor: '#276fbf',  // 填充顏色
                fillOpacity: 0.1       // 透明度
              }
            ).addTo(micro_map);
        }

        // 圖層管理
        var micro_baseMaps = {
            "臺灣通用電子地圖": mnlsc_EMAP98,
            "Taiwan E-Map(EN)": mnlsc_EMAP97,
            "臺灣通用電子地圖正射影像(航照混合) ": mnlsc_PHOTO_MIX,
            "坡向圖": mnlsc_MOI_SLOPEP_LV7_2,
        };
        var micro_overlayMaps = {
            "temple": temple,
            "pollution": pollution,
            "gasStation": gasStation,
            "intersection": intersection,
            "nightMarket": nightMarket,
            "等高線圖": mnlsc_MOI_CONTOUR_2,
            "縣市界": mnlsc_CITY,
            "各級學校範圍圖": mnlsc_SCHOOL,
            "臺灣通用電子地圖道路路網": mnlsc_ROAD,
      	    "便利商店(超商)": mnlsc_ConvenienceStore,
      	    "臺灣通用電子地圖(透明)": mnlsc_EMAP2,
            "國土利用現況調查成果圖": mnlsc_LUIMAP,
            // "農業": LUIMAP01,
            // "森林": LUIMAP02,
            // "交通": LUIMAP03,
            // "水利": LUIMAP04,
            // "建築": LUIMAP05,
            // "公共": LUIMAP06,
            // "遊憩": LUIMAP07,
            // "礦鹽": LUIMAP08,
            // "其他": LUIMAP09,
        };
        L.control.layers(micro_baseMaps, micro_overlayMaps).addTo(micro_map);

        // --- 搜尋規則 --- //
        // 搜尋規則
        function search(data, minSupport, minConfidence, searchAntecedents, searchConsequents) {
          var table = `
          <table id = 'tableid' class = 'table'>
            <tr>
              <th scope='col'>#</th>
              <th scope='col'>Antecedents</th>
              <th scope='col'>Consequents</th>
              <th scope='col'>Support</th>
              <th scope='col'>Confidence</th>
            </tr>
          `
          var count = 1;
          for (var i = 0; i < data.length; i++) {
            if (data[i].support >= minSupport && data[i].confidence >= minConfidence && data[i].antecedents.toString().indexOf(searchAntecedents)!=-1 && data[i].consequents.toString().indexOf(searchConsequents)!=-1) { 
              var supp = data[i].support
              var conf = data[i].confidence
              table += '<tr><th scope="row">'+count+'</th><td>'+data[i].antecedents+'</td><td>'+data[i].consequents+'</td><td>'+Number(supp).toFixed(3)+'</td><td>'+Number(conf).toFixed(3).toString()+'</td></tr>';
              console.log(supp, conf);
              count += 1;
            }
          }
          table += '</table>'
          count -= 1
          return {"table": table, "count": count.toString()};
        }

        // Submit 觸發函數
        function show_rules(mode) {
          var select_year = document.getElementById(mode+'_year');
          var year = select_year.options[select_year.selectedIndex].value;
          var select_site = document.getElementById(mode+'_site');
          var site = select_site.options[select_site.selectedIndex].value;
          var minSupport = document.getElementById(mode+'_minSupport').value;
          var minConfidence = document.getElementById(mode+'_minConfidence').value;
          var searchAntecedents = document.getElementById(mode+'_antecedents').value;
          var searchConsequents = document.getElementById(mode+'_consequents').value;
          if (mode == 'super')
            data = supersite_rules[site][year];
          else if (mode == 'micro')
            data = microsite_rules[site][year];
          result = search(data, parseFloat(minSupport), parseFloat(minConfidence), searchAntecedents, searchConsequents);
          document.getElementById(mode+"_rulesid").innerHTML = result["table"];
          document.getElementById(mode+"_countid").innerHTML = "總計 "+result["count"]+" 條";
        }

        document.getElementById("super_trigger").onclick = function() { show_rules('super');}
        document.getElementById("micro_trigger").onclick = function() { show_rules('micro');}
      </script>
    </body>
</html>
